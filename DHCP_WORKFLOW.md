# ะะฐะฑะพัะฐ Camera Agent ั DHCP

## ๐ฏ ะะพะดัะฒะตัะถะดะตะฝะธะต: DHCP ะฟะพะปะฝะพัััั ะฟะพะดะดะตัะถะธะฒะฐะตััั!

ะะฐ, ะบะฐะผะตัะฐ ะฑัะดะตั ัะฐะฑะพัะฐัั **ัะพัะฝะพ ัะฐะบ ะถะต**, ะบะฐะบ ะทะฐะดัะผะฐะฝะพ, ะดะฐะถะต ะตัะปะธ ะพะฝะฐ ะฟะพะปััะธั IP-ะฐะดัะตั ัะตัะตะท DHCP ะพั ัะพััะตัะฐ. ะะพั ะฟะพะดัะพะฑะฝะพะต ะพะฑัััะฝะตะฝะธะต:

## ๐ ะัะพัะตัั ัะฐะฑะพัั ั DHCP

### 1. **ะะพะปััะตะฝะธะต IP ัะตัะตะท DHCP**
```
ะะพััะตั (DHCP ัะตัะฒะตั) โ ะะฐะผะตัะฐ ะฟะพะปััะฐะตั IP (ะฝะฐะฟัะธะผะตั, 192.168.1.100)
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะะฐะผะตัะฐ ะฟะพะดะบะปััะฐะตััั ะบ ัะพััะตัั
- ะะพััะตั ะฒัะดะฐะตั IP ัะตัะตะท DHCP (ะฝะฐะฟัะธะผะตั, `192.168.1.100`)
- ะะฐะผะตัะฐ ะฟะพะปััะฐะตั IP, ะผะฐัะบั ะฟะพะดัะตัะธ, ัะปัะท, DNS

### 2. **ะะณะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั IP**
```python
def _detect_camera_ip(self) -> str:
    """ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต IP ะบะฐะผะตัั"""
    try:
        # ะะพะปััะตะฝะธะต IP ัะตัะตะท socket
        with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
            s.connect(("8.8.8.8", 80))
            local_ip = s.getsockname()[0]
            return local_ip  # ะะฐะฟัะธะผะตั: 192.168.1.100
    except Exception as e:
        return "127.0.0.1"  # Fallback
```

**ะะตะทัะปััะฐั:** ะะณะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะทะฝะฐะตั, ััะพ ะบะฐะผะตัะฐ ะธะผะตะตั IP `192.168.1.100`

### 3. **ะะพะบะฐะปัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต ะฐะณะตะฝัะฐ ะบ ะบะฐะผะตัะต**
```
ะะณะตะฝั โ 127.0.0.1:554 (localhost)
ะะะ
ะะณะตะฝั โ 192.168.1.100:554 (ะปะพะบะฐะปัะฝัะน IP)
```

**ะะฐะถะฝะพ:** ะะณะตะฝั ัะฐะฑะพัะฐะตั **ะปะพะบะฐะปัะฝะพ** ะฝะฐ ัะพะน ะถะต ะบะฐะผะตัะต, ะฟะพััะพะผั:
- ะะฐะผะตัะฐ ะดะพัััะฟะฝะฐ ะบะฐะบ `127.0.0.1` (localhost)
- ะะปะธ ะบะฐะบ `192.168.1.100` (ะปะพะบะฐะปัะฝัะน IP)
- **ะะต ะฒะฐะถะฝะพ, ะบะฐะบะพะน IP ะฟะพะปััะธะปะฐ ะบะฐะผะตัะฐ ะพั DHCP**

### 4. **ะััะพะดััะตะต ัะพะตะดะธะฝะตะฝะธะต ะบ ััะฝะฝะตะปัะฝะพะผั ัะตัะฒะตัั**
```
ะะณะตะฝั โ ะะพััะตั (192.168.1.100) โ ะะฝัะตัะฝะตั โ ะขัะฝะฝะตะปัะฝัะน ัะตัะฒะตั
```

**ะะปััะตะฒะพะน ะผะพะผะตะฝั:** ะกะพะตะดะธะฝะตะฝะธะต **ะธะฝะธัะธะธััะตััั ะฐะณะตะฝัะพะผ** (ะธััะพะดััะตะต):
- ะะพััะตั ะฟัะพะฟััะบะฐะตั ะธััะพะดััะธะน ััะฐัะธะบ
- NAT ัะฐะฑะพัะฐะตั ะฒ ััะพัะพะฝั "ะธะทะฝัััะธ ะฝะฐััะถั"
- **ะะต ะฝัะถะตะฝ ะฟัะพะฑัะพั ะฟะพััะพะฒ**

### 5. **ะขัะฝะฝะตะปั ะฝะฐ ัะตัะฒะตัะต**
```
ะขัะฝะฝะตะปัะฝัะน ัะตัะฒะตั โ 127.0.0.1:8554 (ะปะพะบะฐะปัะฝะพ ะฝะฐ ัะตัะฒะตัะต)
```

**ะะตะทัะปััะฐั:** Flussonic Watcher ะฒะธะดะธั ะบะฐะผะตัั ะบะฐะบ ะปะพะบะฐะปัะฝัั ะฝะฐ `127.0.0.1:8554`

## ๐๏ธ ะะตัะฐะปัะฝะฐั ััะตะผะฐ ั DHCP

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    IP-ะะะะะะ (192.168.1.100)                  โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ โ
โ  โ   RTSP Server   โ  โ  Camera Agent   โ  โ   DHCP Client   โ โ
โ  โ (127.0.0.1:554) โโโโค   (ะฝะฐั ะบะพะด)     โโโบโ  (192.168.1.100)โ โ
โ  โ                 โ  โ                 โ  โ                 โ โ
โ  โ - H.264/H.265   โ  โ - Auto-detect   โ  โ - DHCP ะฟะพะปััะตะฝ  โ โ
โ  โ - Multiple      โ  โ - Local access  โ  โ - IP ะฟะพะปััะตะฝ    โ โ
โ  โ   Streams       โ  โ - Tunnel client โ  โ - Gateway set   โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                โ
                                โ ะััะพะดััะตะต ัะพะตะดะธะฝะตะฝะธะต
                                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะฃะขะะ (DHCP Server)                        โ
โ  - DHCP: 192.168.1.100 โ ะะฐะผะตัะฐ                               โ
โ  - NAT: ะััะพะดััะธะน ััะฐัะธะบ ัะฐะทัะตัะตะฝ                             โ
โ  - Firewall: ะะปะพะบะธััะตั ะฒัะพะดััะธะต ัะพะตะดะธะฝะตะฝะธั                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                โ
                                โ ะะฝัะตัะฝะตั
                                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ะขะฃะะะะะฌะะซะ ะกะะะะะ                            โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ โ
โ  โ   WebSocket     โ  โ   TCP Tunnel    โ  โ   Local RTSP    โ โ
โ  โ   Server        โโโโค   Server        โโโบโ   Proxy         โ โ
โ  โ                 โ  โ                 โ  โ                 โ โ
โ  โ - ะัะธะตะผ ะฐะณะตะฝัะพะฒ โ  โ - TCP ััะฝะฝะตะปั   โ  โ - 127.0.0.1:8554โ โ
โ  โ - ะฃะฟัะฐะฒะปะตะฝะธะต    โ  โ - ะัะพะทัะฐัะฝะพััั  โ  โ - RTSP ะฟัะพะบัะธ   โ โ
โ  โ - ะะพะฝะธัะพัะธะฝะณ    โ  โ - NAT traversal โ  โ - Flussonic API โ โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                โ
                                โ ะะพะบะฐะปัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต
                                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   FLUSSONIC WATCHER                            โ
โ  - ะะพะดะบะปััะตะฝะธะต ะบ 127.0.0.1:8554 (ะปะพะบะฐะปัะฝะพ)                     โ
โ  - ะะฐะฑะพัะฐะตั ะบะฐะบ ั ะปะพะบะฐะปัะฝะพะน ะบะฐะผะตัะพะน                             โ
โ  - ะะพะปะฝะฐั ะฟัะพะทัะฐัะฝะพััั ััะฝะฝะตะปั                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง ะะพะฝัะธะณััะฐัะธั ะดะปั DHCP

### ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต IP
```json
{
  "camera": {
    "ip": "127.0.0.1",
    "auto_detect_ip": true,
    "rtsp_port": 554
  }
}
```

### ะะพะณะธ ะฐะณะตะฝัะฐ ะฟัะธ ะพะฟัะตะดะตะปะตะฝะธะธ IP
```
[STREAM] ะะฑะฝะฐััะถะตะฝ IP ะบะฐะผะตัั: 192.168.1.100
[TUNNEL] ะะพะดะบะปััะตะฝะธะต ะบ ััะฝะฝะตะปัะฝะพะผั ัะตัะฒะตัั...
[TUNNEL] ะขัะฝะฝะตะปั ัััะฐะฝะพะฒะปะตะฝ: 127.0.0.1:8554
[AGENT] ะะณะตะฝั ะณะพัะพะฒ ะบ ัะฐะฑะพัะต
```

## ๐ฏ ะัะตะธะผััะตััะฒะฐ DHCP + Tunnel

### 1. **ะัะพััะพัะฐ ะฝะฐัััะพะนะบะธ**
- ะะฐะผะตัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะปััะฐะตั IP
- ะะณะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั IP
- ะะธะบะฐะบะธั ััะฐัะธัะตัะบะธั ะฝะฐัััะพะตะบ

### 2. **ะะตะทะพะฟะฐัะฝะพััั**
- ะะตั ะพัะบััััั ะฟะพััะพะฒ ะฝะฐ ัะพััะตัะต
- ะััะพะดััะตะต ัะพะตะดะธะฝะตะฝะธะต ัะตัะตะท NAT
- ะขัะฝะฝะตะปั ัะธัััะตััั

### 3. **ะะฐัััะฐะฑะธััะตะผะพััั**
- ะัะฑะพะต ะบะพะปะธัะตััะฒะพ ะบะฐะผะตั ั DHCP
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฟัะฐะฒะปะตะฝะธะต IP
- ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต

### 4. **ะกะพะฒะผะตััะธะผะพััั ั Flussonic**
- Flussonic ะฒะธะดะธั ะบะฐะผะตัั ะบะฐะบ ะปะพะบะฐะปัะฝัะต
- ะะพะปะฝะฐั ะฟัะพะทัะฐัะฝะพััั ััะฝะฝะตะปั
- ะกัะฐะฝะดะฐััะฝัะน RTSP ะฟัะพัะพะบะพะป

## ๐ ะัะธะผะตั ัะฐะฑะพัั

### ะกัะตะฝะฐัะธะน: ะะฐะผะตัะฐ ะฟะพะปััะธะปะฐ IP 192.168.1.100

1. **DHCP:** ะะพััะตั ะฒัะดะฐะป `192.168.1.100`
2. **ะะณะตะฝั:** ะะฟัะตะดะตะปะธะป IP ะบะฐะผะตัั
3. **ะะพะบะฐะปัะฝัะน ะดะพัััะฟ:** ะะณะตะฝั ะฟะพะดะบะปััะธะปัั ะบ `127.0.0.1:554`
4. **ะขัะฝะฝะตะปั:** ะกะพะทะดะฐะป ัะพะตะดะธะฝะตะฝะธะต ั ััะฝะฝะตะปัะฝัะผ ัะตัะฒะตัะพะผ
5. **Flussonic:** ะะพะดะบะปััะธะปัั ะบ `127.0.0.1:8554` (ะปะพะบะฐะปัะฝะพ ะฝะฐ ัะตัะฒะตัะต)

### ะะตะทัะปััะฐั:
- โ ะะฐะผะตัะฐ ัะฐะฑะพัะฐะตั ั DHCP IP
- โ ะขัะฝะฝะตะปั ัััะฐะฝะพะฒะปะตะฝ
- โ Flussonic ะฒะธะดะธั ะบะฐะผะตัั ะบะฐะบ ะปะพะบะฐะปัะฝัั
- โ ะะพะปะฝะฐั ะฟัะพะทัะฐัะฝะพััั

## ๐ ะกะผะตะฝะฐ IP ะฐะดัะตัะฐ

ะัะปะธ ะบะฐะผะตัะฐ ะฟะพะปััะธั ะฝะพะฒัะน IP ะพั DHCP:

1. **ะะณะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปะธั ะฝะพะฒัะน IP**
2. **ะะตัะตะฟะพะดะบะปััะธััั ะบ ััะฝะฝะตะปัะฝะพะผั ัะตัะฒะตัั**
3. **ะขัะฝะฝะตะปั ะฑัะดะตั ะฒะพัััะฐะฝะพะฒะปะตะฝ**
4. **Flussonic ะฟัะพะดะพะปะถะธั ัะฐะฑะพัั ะฑะตะท ะฟะตัะตััะฒะฐ**

## ๐ ะะพะฝะธัะพัะธะฝะณ DHCP

### ะกัะฐัะธััะธะบะฐ ะฐะณะตะฝัะฐ
```json
{
  "camera": {
    "ip": "192.168.1.100",
    "dhcp_enabled": true,
    "auto_detected": true
  },
  "tunnel": {
    "status": "connected",
    "server_port": 8554
  }
}
```

---

**ะัะฒะพะด: DHCP ะฟะพะปะฝะพัััั ะฟะพะดะดะตัะถะธะฒะฐะตััั ะธ ัะฐะฑะพัะฐะตั ัะพัะฝะพ ัะฐะบ ะถะต, ะบะฐะบ ะทะฐะดัะผะฐะฝะพ! ะะณะตะฝั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะดะฐะฟัะธััะตััั ะบ ะปัะฑะพะผั IP, ะฟะพะปััะตะฝะฝะพะผั ะพั DHCP.**



