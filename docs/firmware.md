# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏ —Å Camera Agent

## –û–±–∑–æ—Ä

Camera Agent –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –≤ –ø—Ä–æ—à–∏–≤–∫—É IP-–∫–∞–º–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã NAT traversal –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –û–±—ã—á–Ω–∞—è —Å—Ö–µ–º–∞ (–ø—Ä–æ–±–ª–µ–º—ã):
```
–û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ‚Üí NAT/Firewall ‚Üí IP-–∫–∞–º–µ—Ä–∞ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
```

### –° Camera Agent (—Ä–µ—à–µ–Ω–∏–µ):
```
IP-–∫–∞–º–µ—Ä–∞ + Agent ‚Üí NAT/Firewall ‚Üí –û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–∞–º–µ—Ä–∞)
```

## üîß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–∞–º–µ—Ä—ã

### Dahua (Dahua Technology)
- **IPC-HFW2449** - 4MP –∫—É–ø–æ–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
- **IPC-HDBW4431** - 4MP –∫—É–ø–æ–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞  
- **IPC-HFW4831** - 8MP –∫—É–ø–æ–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
- **IPC-HDW4831** - 8MP –∫—É–ø–æ–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞

### Hikvision
- **DS-2CD2xxx** —Å–µ—Ä–∏—è - 2MP –∫–∞–º–µ—Ä—ã
- **DS-2CD7xxx** —Å–µ—Ä–∏—è - 7MP –∫–∞–º–µ—Ä—ã
- **DS-2CD4xxx** —Å–µ—Ä–∏—è - 4MP –∫–∞–º–µ—Ä—ã

### Axis Communications
- **M30** —Å–µ—Ä–∏—è - —Å–µ—Ç–µ–≤–∞—è –∫–∞–º–µ—Ä–∞
- **M50** —Å–µ—Ä–∏—è - —Å–µ—Ç–µ–≤–∞—è –∫–∞–º–µ—Ä–∞
- **P12** —Å–µ—Ä–∏—è - PTZ –∫–∞–º–µ—Ä–∞

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd camera-agent-firmware

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∫–∞–º–µ—Ä—ã

```bash
# –°–±–æ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è Dahua IPC-HFW2449
python tools/build_agent.py --camera dahua-2449 --output firmware/dahua-2449/

# –°–±–æ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è Hikvision DS-2CD2043
python tools/build_agent.py --camera hikvision-ds2cd --output firmware/hikvision/
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano firmware/dahua-2449/config.json
```

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```json
{
  "agent": {
    "agent_id": "dahua-001",
    "cloud_server_url": "wss://your-cloud-server.com/agent",
    "cloud_server_token": "your-secret-token",
    "log_level": "INFO"
  },
  "streaming": {
    "quality": "high",
    "buffer_size": 2097152,
    "rtsp_port": 554,
    "stream_paths": ["/cam/realmonitor?channel=1&subtype=0"]
  },
  "network": {
    "connection_timeout": 30,
    "reconnect_interval": 10,
    "heartbeat_interval": 30
  }
}
```

### 4. –°–±–æ—Ä–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏

```bash
cd firmware/dahua-2449/
make build
```

### 5. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –∫–∞–º–µ—Ä—É

#### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–º–µ—Ä—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–º–µ—Ä—ã (–æ–±—ã—á–Ω–æ http://192.168.1.100)
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É (admin/admin –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "System" ‚Üí "Maintenance" ‚Üí "Upgrade"
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `dahua-2449_firmware.tar.gz`
5. –ù–∞–∂–º–∏—Ç–µ "Upgrade"

#### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ TFTP

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TFTP —Å–µ—Ä–≤–µ—Ä–∞
sudo apt-get install tftpd-hpa
sudo cp dahua-2449_firmware.tar.gz /srv/tftp/

# –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ TFTP –Ω–∞ –∫–∞–º–µ—Ä–µ
tftp -g -r dahua-2449_firmware.tar.gz 192.168.1.10
```

#### –ú–µ—Ç–æ–¥ 3: –ß–µ—Ä–µ–∑ SSH (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–∞–º–µ—Ä—É
scp dahua-2449_firmware.tar.gz admin@192.168.1.100:/tmp/

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–∞–º–µ—Ä–µ
ssh admin@192.168.1.100

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞
cd /tmp
tar -xzf dahua-2449_firmware.tar.gz
./install.sh
```

## üîß –î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```json
{
  "agent": {
    "agent_id": "unique-agent-id",           // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∞–≥–µ–Ω—Ç–∞
    "cloud_server_url": "wss://server.com",  // URL –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
    "cloud_server_token": "secret-token",    // –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    "log_level": "INFO"                      // –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  }
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞:

```json
{
  "streaming": {
    "quality": "high",                       // –ö–∞—á–µ—Å—Ç–≤–æ: low/medium/high
    "buffer_size": 2097152,                  // –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ (–±–∞–π—Ç—ã)
    "rtsp_port": 554,                        // –ü–æ—Ä—Ç RTSP —Å–µ—Ä–≤–µ—Ä–∞ –∫–∞–º–µ—Ä—ã
    "stream_paths": [                        // –ü—É—Ç–∏ –∫ –ø–æ—Ç–æ–∫–∞–º
      "/cam/realmonitor?channel=1&subtype=0"
    ]
  }
}
```

#### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```json
{
  "network": {
    "connection_timeout": 30,                // –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–µ–∫)
    "reconnect_interval": 10,                // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–µ–∫)
    "heartbeat_interval": 30,                // –ò–Ω—Ç–µ—Ä–≤–∞–ª heartbeat (—Å–µ–∫)
    "max_retries": 5                         // –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  }
}
```

### –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### Dahua –∫–∞–º–µ—Ä—ã:

```json
{
  "camera": {
    "model": "dahua-2449",
    "platform": "linux_arm",
    "architecture": "armv7",
    "rtsp_port": 554,
    "http_port": 80,
    "config_file": "/mnt/mtd/Config/Account1"
  }
}
```

#### Hikvision –∫–∞–º–µ—Ä—ã:

```json
{
  "camera": {
    "model": "hikvision-ds2cd",
    "platform": "linux_arm", 
    "architecture": "armv7",
    "rtsp_port": 554,
    "http_port": 80,
    "config_file": "/davinci/account"
  }
}
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–π –∫–∞–º–µ—Ä—ã

1. **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∫–∞–º–µ—Ä—ã:**

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–∞–º–µ—Ä–µ –ø–æ SSH (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
ssh admin@192.168.1.100

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
uname -a
cat /proc/cpuinfo

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
netstat -tlnp

# –ü—Ä–æ–≤–µ—Ä–∫–∞ RTSP –ø–æ—Ç–æ–∫–æ–≤
ffmpeg -i rtsp://192.168.1.100:554/stream1 -t 5 -f null -
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤–æ–π –∫–∞–º–µ—Ä—ã
python tools/create_camera_config.py --camera new-model --output configs/
```

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–±–æ—Ä—â–∏–∫:**

```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ camera_configs –≤ build_agent.py
"new-model": {
    "platform": "linux_arm",
    "architecture": "armv7", 
    "libc": "uclibc",
    "rtsp_port": 554,
    "http_port": 80,
    "stream_paths": ["/your/stream/path"],
    "config_file": "/path/to/config",
    "binary_path": "/usr/bin/camera_agent"
}
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
python agent/core/agent.py --config test-config.json --test-mode

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
curl http://localhost:8080/agents
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ:

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
scp test-agent.tar.gz admin@192.168.1.100:/tmp/

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–∞–º–µ—Ä–µ
ssh admin@192.168.1.100
cd /tmp && tar -xzf test-agent.tar.gz
./install.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
systemctl status camera-agent
journalctl -u camera-agent -f
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ systemd
journalctl -u camera-agent -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤
tail -f /var/log/camera_agent/agent.log

# –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
DEBUG - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
INFO - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ
WARNING - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
ERROR - –æ—à–∏–±–∫–∏
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
ping your-cloud-server.com
telnet your-cloud-server.com 8080

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
wscat -c wss://your-cloud-server.com/agent/test-agent-id
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏
top -p $(pgrep camera_agent)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏
iftop -i eth0

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h
du -sh /var/log/camera_agent/
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ê–≥–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   cat /etc/camera_agent/config.json
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   ```bash
   ping your-cloud-server.com
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   journalctl -u camera-agent --since "1 hour ago"
   ```

### –ü–æ—Ç–æ–∫ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ RTSP –ø–æ—Ç–æ–∫–∏ –∫–∞–º–µ—Ä—ã:**
   ```bash
   ffmpeg -i rtsp://localhost:554/stream1 -t 5 -f null -
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```bash
   ls -la /usr/bin/camera_agent
   ```

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

1. **–£–º–µ–Ω—å—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–∞:**
   ```json
   {
     "streaming": {
       "quality": "medium"  // –≤–º–µ—Å—Ç–æ "high"
     }
   }
   ```

2. **–£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞:**
   ```json
   {
     "streaming": {
       "buffer_size": 1048576  // 1MB –≤–º–µ—Å—Ç–æ 2MB
     }
   }
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](api.md)
- [–û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä](cloud-server.md)
- [–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](integration.md)
- [FAQ](faq.md)


