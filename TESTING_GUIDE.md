# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Camera Agent

## –ß—Ç–æ –º—ã –º–æ–∂–µ–º –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

–ò–º–µ—è —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—Ä–æ—à–∏–≤–∫—É Flussonic Agent, –º—ã –º–æ–∂–µ–º:

1. ‚úÖ **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã** - –∏–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à –∞–≥–µ–Ω—Ç** - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏
3. ‚úÖ **–°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã** - —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. ‚ö†Ô∏è **–ó–∞–ø—É—Å—Ç–∏—Ç—å peeklio1** - —Å–ª–æ–∂–Ω–æ (ARM –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

---

## üìÇ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–æ—à–∏–≤–∫–∏

–ò–∑ `C:\Users\King\Desktop\Dahua\firmware_extracted\`:

```
manual_extract/
‚îú‚îÄ‚îÄ romfs-x.squashfs.img ‚Üê –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (19MB)
‚îÇ   –°–æ–¥–µ—Ä–∂–∏—Ç: peeklio1, app.sh, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îú‚îÄ‚îÄ web-x.squashfs.img ‚Üê Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (7.2MB)
‚îú‚îÄ‚îÄ kernel.img ‚Üê –Ø–¥—Ä–æ Linux (2.5MB)
‚îî‚îÄ‚îÄ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...
```

---

## üîç –ß—Ç–æ –º—ã —É–∂–µ —É–∑–Ω–∞–ª–∏ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞

### 1. –ó–∞–ø—É—Å–∫ peeklio1

–ò–∑ `app.sh`:
```bash
./peeklio1 -c /mnt/mtd/Config/peeklio.cfg \
           -A C1.pem \
           -e peeklioroot.crt \
           -M 2956 \
           -S $deviceid
```

### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|----------|----------|-----------------|
| `-c peeklio.cfg` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | `config.json` |
| `-A C1.pem` | SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ | `agent.pem` |
| `-e peeklioroot.crt` | Root SSL | `root.crt` |
| `-M 2956` | –ü–æ—Ä—Ç —Ç—É–Ω–Ω–µ–ª—è | `tunnel_port: 2956` |
| `-S deviceid` | Device ID | –ê–≤—Ç–æ –∏–∑ armbenv |

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞ Windows

```bash
# 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd C:\Cursor\camera-agent-firmware

# 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º: firmware/dahua-2449s-il/config.json

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏
python demo_windows.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Linux VM

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/twinleq/camera-agent.git
cd camera-agent

# 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install -r requirements.txt

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≥–µ–Ω—Ç–∞
python3 -m agent.core.agent --config firmware/dahua-2449s-il/config.json
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
# 1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t camera-agent .

# 2. –ó–∞–ø—É—Å–∫
docker run -d \
  --name camera-agent \
  -v ./firmware/dahua-2449s-il/config.json:/app/config.json \
  camera-agent
```

---

## üß© –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Flussonic

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Ç—É–Ω–Ω–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä:

```python
# tunnel_test_server.py
import asyncio
import websockets
import json

async def handle_agent(websocket, path):
    print("[SERVER] –ê–≥–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è")
    
    # –ü—Ä–∏–Ω–∏–º–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
    registration = await websocket.recv()
    data = json.loads(registration)
    print(f"[SERVER] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {data}")
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
    response = {
        "status": "registered",
        "device_id": data.get("device_id"),
        "tunnel_port": 2956
    }
    await websocket.send(json.dumps(response))
    
    # –°–ª—É—à–∞–µ–º heartbeat
    async for message in websocket:
        msg_data = json.loads(message)
        print(f"[SERVER] –ü–æ–ª—É—á–µ–Ω–æ: {msg_data}")

async def main():
    server = await websockets.serve(handle_agent, "0.0.0.0", 8080)
    print("[SERVER] –¢—É–Ω–Ω–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ ws://0.0.0.0:8080")
    await server.wait_closed()

asyncio.run(main())
```

–ó–∞–ø—É—Å–∫:
```bash
python tunnel_test_server.py
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≥–µ–Ω—Ç–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `firmware/dahua-2449s-il/config.json`:

```json
{
  "agent": {
    "connection_mode": "tunnel"
  },
  "tunnel": {
    "enabled": true,
    "server_url": "ws://localhost:8080",
    "server_token": "test-token",
    "tunnel_port": 2956
  }
}
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞

```bash
python demo_windows.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
[AGENT] –ó–∞–ø—É—Å–∫ Camera Agent (Device ID: test-device-001)
[TUNNEL] –†–µ–∂–∏–º —Ç—É–Ω–Ω–µ–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
[TUNNEL] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ws://localhost:8080
[TUNNEL] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
[TUNNEL] –¢—É–Ω–Ω–µ–ª—å —Å–æ–∑–¥–∞–Ω: 127.0.0.1:2956
[AGENT] Camera Agent –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ
```

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```
[SERVER] –ê–≥–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è
[SERVER] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {"device_id": "test-device-001", ...}
[SERVER] –ü–æ–ª—É—á–µ–Ω–æ: {"type": "heartbeat", ...}
```

---

## üî¨ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –ø—Ä–æ—à–∏–≤–∫–∏

### –ü–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

–í Linux VM:
```bash
# –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º romfs-x.squashfs.img
cd ~/firmware_analysis
dumpimage -T standalone -p 0 romfs-x.squashfs.img -o romfs-payload.gz
gunzip romfs-payload.gz
unsquashfs romfs-payload

# –ò—â–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cd squashfs-root/
find . -name "*.cfg" -o -name "*.conf" -o -name "*.pem" -o -name "*.crt"
```

### –ê–Ω–∞–ª–∏–∑ peeklio1

```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏–Ω–∞—Ä–Ω–∏–∫–µ
file squashfs-root/mnt/app/peeklio1

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å ldd)
ldd squashfs-root/mnt/app/peeklio1

# –°—Ç—Ä–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ (–∏—â–µ–º URL, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
strings squashfs-root/mnt/app/peeklio1 | grep -i "http\|wss\|rtsp\|server\|device"
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/agent.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep -i "error\|failed" logs/agent.log
```

### –ú–µ—Ç—Ä–∏–∫–∏ (Prometheus)

–ê–≥–µ–Ω—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ `http://localhost:9090/metrics`:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:9090/metrics

# –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
# - agent_status (0=stopped, 1=starting, 2=connected, 3=streaming, 4=error)
# - agent_uptime_seconds
# - tunnel_connected (0/1)
# - p2p_connected (0/1)
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–≥–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `server_url` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `netstat -an | findstr 8080`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `netsh advfirewall show currentprofile`

### –ü—Ä–æ–±–ª–µ–º–∞: SSL –æ—à–∏–±–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤: `agent.pem`, `root.crt`
2. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–∏—Ç–µ SSL: `"ssl_enabled": false`

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞–º–µ—Ä–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∫–∞–º–µ—Ä—ã: `ping 192.168.1.10`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RTSP: `ffprobe rtsp://192.168.1.10:554/...`
3. –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: `"auto_detect_ip": true`

---

## üìã –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] ‚úÖ –ê–≥–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç—É–Ω–Ω–µ–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- [ ] ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å device_id
- [ ] ‚úÖ Heartbeat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- [ ] ‚úÖ –¢—É–Ω–Ω–µ–ª—å —Å–æ–∑–¥–∞–Ω –Ω–∞ –ø–æ—Ä—Ç—É 2956
- [ ] ‚úÖ SSL –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- [ ] ‚ö†Ô∏è P2P —Ä–µ–∂–∏–º (—Ç—Ä–µ–±—É–µ—Ç STUN/TURN —Å–µ—Ä–≤–µ—Ä–∞)
- [ ] ‚ö†Ô∏è Hybrid —Ä–µ–∂–∏–º —Å fallback
- [ ] ‚ö†Ô∏è –ü—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–º–µ—Ä–µ

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üê –ú—ã –∑–¥–µ—Å—å
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –Ω–∞ Windows/Linux
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—É–Ω–Ω–µ–ª—å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–µ**
   - –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ—à–∏–≤–∫—É –¥–ª—è Dahua
   - –ó–∞–º–µ–Ω–∏—Ç—å peeklio1 –Ω–∞ –Ω–∞—à –∞–≥–µ–Ω—Ç
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º RTSP –ø–æ—Ç–æ–∫–æ–º

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Flussonic Watcher**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π Flussonic —Å–µ—Ä–≤–µ—Ä
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞–≥–µ–Ω—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [FLUSSONIC_ANALYSIS.md](FLUSSONIC_ANALYSIS.md) - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ peeklio1
- [QUICK_COMMANDS.md](QUICK_COMMANDS.md) - –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Linux
- [LINUX_ANALYSIS_GUIDE.md](LINUX_ANALYSIS_GUIDE.md) - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–∞ Linux VM

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: 7 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: üü¢ –ì–æ—Ç–æ–≤–æ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
