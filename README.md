# Camera Agent Firmware - Агент для IP-камер

Агент для встраивания в прошивку IP-камер (Dahua, Hikvision, Axis и др.) для автоматического подключения к облачному серверу видеонаблюдения.

## 🎯 Назначение

Агент решает ключевые проблемы доступа к IP-камерам:

- **NAT Traversal** - камера сама подключается к облачному серверу
- **Буферизация** - повторная отправка потерянных пакетов  
- **Автоматическая регистрация** - камера регистрируется на сервере автоматически
- **Стабильность соединения** - переподключение при сбоях

## 🏗️ Архитектура

### Проблема (обычная схема):
```
Облачный сервер → NAT/Firewall → IP-камера (недоступна)
```

### Решение (с Camera Agent):
```
IP-камера + Agent → NAT/Firewall → Облачный сервер (подключение инициирует камера)
```

### Детальная архитектура:

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   IP-Камера     │    │   Cloud Server  │    │   Web Portal    │
│   + Agent       │◄──►│   (Watcher)     │◄──►│   (Management)  │
│   (Dahua/etc)   │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        │                        │                        │
        │ RTSP Stream            │ WebSocket              │ HTTP API
        ▼                        ▼                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Local Network │    │   Stream Relay  │    │   User Interface│
│   (NAT/Firewall)│    │   & Buffer      │    │   & Analytics   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🚀 Возможности агента

### Основные функции:
- 🔌 **Автоподключение** к облачному серверу
- 📡 **RTSP/RTMP стриминг** с камеры на сервер
- 🔄 **Буферизация и переотправка** потерянных пакетов
- 🔐 **Шифрованное соединение** с сервером
- 📊 **Мониторинг состояния** камеры
- 🔧 **Дистанционное управление** через сервер

### Поддерживаемые камеры:
- **Dahua** (IPC-HFW2449, IPC-HDBW4431 и др.)
- **Hikvision** (DS-2CD2xxx, DS-2CD7xxx и др.)
- **Axis** (M30, M50, P12 и др.)
- **Generic ONVIF** камеры

## 📁 Структура проекта

```
camera-agent-firmware/
├── agent/                    # Основной код агента
│   ├── core/                # Ядро агента
│   ├── streaming/           # Обработка видео потоков
│   ├── networking/          # Сетевые функции
│   └── platform/           # Платформо-специфичный код
├── firmware/               # Инструменты для создания прошивки
├── cloud-server/          # Облачный сервер для приема агентов
├── tools/                 # Утилиты для разработки
└── docs/                  # Документация
```

## 🔧 Быстрый старт

### 1. Создание агента для камеры

```bash
# Клонирование репозитория
git clone <repository-url>
cd camera-agent-firmware

# Сборка агента для конкретной камеры
python tools/build_agent.py --camera dahua-2449 --output firmware/
```

### 2. Загрузка в камеру

```bash
# Создание прошивки с агентом
python tools/create_firmware.py --input agent/ --camera dahua-2449

# Загрузка через веб-интерфейс камеры или TFTP
```

### 3. Подключение к облачному серверу

```bash
# Запуск облачного сервера
cd cloud-server
python server.py --config config.yaml
```

## 📚 Документация

- **[Установка агента](docs/installation.md)**
- **[Создание прошивки](docs/firmware.md)**
- **[API агента](docs/agent-api.md)**
- **[Облачный сервер](docs/cloud-server.md)**

## 🔗 Интеграция

Агент совместим с:
- **Flussonic Watcher** - для приема потоков
- **Собственные облачные платформы** - через API
- **ONVIF серверы** - стандартная совместимость

## 📄 Лицензия

MIT License - см. файл [LICENSE](LICENSE)

---

**Создано по образцу Flussonic Agent для сообщества видеонаблюдения**
