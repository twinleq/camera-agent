# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - Camera Agent Firmware

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

Camera Agent - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—à–∏–≤–∫—É IP-–∫–∞–º–µ—Ä—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å NAT –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

## üîç –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ (–æ–±—ã—á–Ω–∞—è —Å—Ö–µ–º–∞):
```
–û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ‚Üí NAT/Firewall ‚Üí IP-–∫–∞–º–µ—Ä–∞ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
```

### ‚úÖ –†–µ—à–µ–Ω–∏–µ (—Å Camera Agent):
```
IP-–∫–∞–º–µ—Ä–∞ + Agent ‚Üí NAT/Firewall ‚Üí –û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–∞–º–µ—Ä–∞)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd camera-agent-firmware

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –≤–∞—à–µ–π –∫–∞–º–µ—Ä—ã

```bash
# –î–ª—è Dahua IPC-HFW2449
python tools/build_agent.py --camera dahua-2449 --output firmware/dahua/

# –î–ª—è Hikvision DS-2CD2043  
python tools/build_agent.py --camera hikvision-ds2cd --output firmware/hikvision/

# –î–ª—è Axis M3046-V
python tools/build_agent.py --camera axis-m30 --output firmware/axis/
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano firmware/dahua/config.json
```

–ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```json
{
  "agent": {
    "agent_id": "my-camera-001",
    "cloud_server_url": "wss://your-server.com/agent",
    "cloud_server_token": "your-secret-token"
  }
}
```

### 4. –°–±–æ—Ä–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏

```bash
cd firmware/dahua/
make build
```

### 5. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –∫–∞–º–µ—Ä—É

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–º–µ—Ä—ã (http://192.168.1.100)
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ System ‚Üí Maintenance ‚Üí Upgrade
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `dahua-2449_firmware.tar.gz`

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ SSH
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
scp dahua-2449_firmware.tar.gz admin@192.168.1.100:/tmp/

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–∞–º–µ—Ä–µ
ssh admin@192.168.1.100
cd /tmp && tar -xzf dahua-2449_firmware.tar.gz
./install.sh
```

### 6. –ó–∞–ø—É—Å–∫ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ –∞–≥–µ–Ω—Ç–æ–≤
cd cloud-server
python server.py --host 0.0.0.0 --port 8080
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
curl http://localhost:8080/agents

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –∫–∞–º–µ—Ä–µ
ssh admin@192.168.1.100
systemctl status camera-agent
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

```bash
# –ó–∞–ø—É—Å–∫ –¥–µ–º–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–∞–º–µ—Ä–∞–º–∏
python example/demo.py --demo

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞–º–µ—Ä—ã
python example/demo.py --camera dahua-2449 --duration 60

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∫–∞–º–µ—Ä
python example/demo.py --list
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
wscat -c ws://localhost:8080/agent/test-agent-id

# –ü—Ä–æ–≤–µ—Ä–∫–∞ RTSP –ø–æ—Ç–æ–∫–∞
ffmpeg -i rtsp://192.168.1.100:554/stream1 -t 10 -f null -
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –∫–∞–º–µ—Ä–µ

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ systemd
journalctl -u camera-agent -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤
tail -f /var/log/camera_agent/agent.log
```

### API –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤
curl http://localhost:8080/agents

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
curl http://localhost:8080/agents/my-camera-001

# –°–ø–∏—Å–æ–∫ –ø–æ—Ç–æ–∫–æ–≤
curl http://localhost:8080/streams

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–º
curl -X POST http://localhost:8080/agents/my-camera-001/control \
  -H "Content-Type: application/json" \
  -d '{"command": "restart"}'
```

## üîß –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–∞–º–µ—Ä—ã

| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å | –ú–æ–¥–µ–ª—å | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | RTSP –ø–æ—Ä—Ç | –°—Ç–∞—Ç—É—Å |
|---------------|--------|-----------|-----------|--------|
| **Dahua** | IPC-HFW2449 | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Dahua** | IPC-HDBW4431 | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Hikvision** | DS-2CD2043 | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Hikvision** | DS-2CD7xxx | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Axis** | M3046-V | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Axis** | M5035 | Linux ARM | 554 | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ê–≥–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   cat /etc/camera_agent/config.json
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å:**
   ```bash
   ping your-server.com
   telnet your-server.com 8080
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   journalctl -u camera-agent --since "1 hour ago"
   ```

### –ü–æ—Ç–æ–∫ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ RTSP –∫–∞–º–µ—Ä—ã:**
   ```bash
   ffmpeg -i rtsp://192.168.1.100:554/stream1 -t 5 -f null -
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞:**
   ```bash
   ls -la /usr/bin/camera_agent
   ```

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

1. **–£–º–µ–Ω—å—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ:**
   ```json
   {
     "streaming": {
       "quality": "medium"  // –≤–º–µ—Å—Ç–æ "high"
     }
   }
   ```

2. **–£–º–µ–Ω—å—à–∏—Ç–µ –±—É—Ñ–µ—Ä:**
   ```json
   {
     "streaming": {
       "buffer_size": 1048576  // 1MB –≤–º–µ—Å—Ç–æ 2MB
     }
   }
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏](docs/firmware.md)** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **[API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/api.md)** - API –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **[–û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä](docs/cloud-server.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- **[–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](docs/integration.md)** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Flussonic Watcher

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **GitHub Issues** - –ë–∞–≥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- **Email** - support@camera-agent.com
- **Telegram** - @camera_agent_support

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è

---

**–°–æ–∑–¥–∞–Ω–æ –ø–æ –æ–±—Ä–∞–∑—Ü—É [Flussonic Agent](https://flussonic.ru/doc/agent-with-watcher/) –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è**


